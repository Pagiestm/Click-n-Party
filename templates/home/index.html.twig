{% extends 'base.html.twig' %}

{% block title %}Accueil
{% endblock %}

{% block body %}
	<div class="py-3 bg-custom-green flex flex-col">
		<div class="flex py-4 items-center overflow-hidden">
			<span class="whitespace-nowrap text-2xl animate-scroll font-cotorisHeavy">
				- WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY&nbsp;</span>
			<span class="whitespace-nowrap text-2xl animate-scroll font-cotorisHeavy">
				- WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY - WELCOME TO CLICK'N PARTY&nbsp;</span>
		</div>
		<div class="w-11/12 m-auto">
			<div class="relative">
				<div class="space-y-4 absolute top-0 right-0 3xl:mt-6 xl:mt-2 mr-2 flex justify-between items-center">
					{% if is_granted('IS_AUTHENTICATED_FULLY') %}
					<a href="#" id="openModal" class="bg-custom_green_dark text-custom-green font-bold py-2 px-4 rounded-full w-10 h-10 md:w-8 md:h-8 xl:w-12 xl:h-12 2xl:w-14 2xl:h-14 flex items-center justify-center 2xl:text-2xl text-md">
						{{ app.user.prenom|slice(0, 1) }}
					</a>
					{% else %}
						<a href="/login" class="bg-custom_green_dark text-custom-green rounded-full font-bold py-2 px-4 md:h-8 lg:h-10 2xl:h-14 flex items-center justify-center">
							Connexion
						</a>
					{% endif %}
				</div>
				<svg
					class="hidden md:block" width="100%" viewbox="0 0 1401 562" fill="none" xmlns="http://www.w3.org/2000/svg">
					<!-- Définition du masque -->
					<mask id="video-mask">
						<path fill="#ffffff" d="M37 0C16.5655 0 0 16.5655 0 37V429C0 449.435 16.5654 466 37 466H267C286.882 466 303 482.118 303 502V525C303 545.435 319.565 562 340 562H1364C1384.43 562 1401 545.435 1401 525V108C1401 87.5655 1384.43 71 1364 71H1156C1137.22 71 1122 55.7777 1122 37V37C1122 16.5655 1105.43 0 1085 0H37Z"/>
					</mask>

					<!-- Forme du SVG -->
					<path
					fill-rule="evenodd" clip-rule="evenodd" d="M37 0C16.5655 0 0 16.5655 0 37V429C0 449.435 16.5654 466 37 466H267C286.882 466 303 482.118 303 502V525C303 545.435 319.565 562 340 562H1364C1384.43 562 1401 545.435 1401 525V108C1401 87.5655 1384.43 71 1364 71H1156C1137.22 71 1122 55.7777 1122 37V37C1122 16.5655 1105.43 0 1085 0H37Z" fill="#A7A3A3"/>

					<!-- Vidéo avec le masque appliqué -->
					<foreignObject x="0" y="0" width="100%" height="100%" mask="url(#video-mask)">
						<body xmlns="http://www.w3.org/1999/xhtml">
							<video autoplay muted loop width="100%" height="100%"><source src="{{ asset('videos/test.mp4') }}" type="video/mp4"></video>
						</body>
					</foreignObject>
				</svg>
				{% include 'home/modal.html.twig' %}
				<div class="absolute bottom-0 left-0 flex space-x-4 md:mb-2 md:ml-3 xl:mb-4 xl:ml-10">
					<a href="#">
						<svg class="md:w-8 md:h-8 lg:w-12 lg:h-12 xl:w-14 xl:h-14 2xl:w-18 2xl:h-16" viewBox="0 0 73 70" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M72.927 33.3994C72.927 53.5377 56.6017 69.8629 36.4635 69.8629L34.9314 69.8629C15.6393 69.8629 -3.67797e-05 54.2236 -3.50932e-05 34.9315C-3.34066e-05 15.6394 15.6393 4.07681e-05 34.9314 4.24547e-05L72.927 4.57764e-05L72.927 33.3994Z" fill="#053F31"/>
							<path fill-rule="evenodd" clip-rule="evenodd" d="M36.4635 44.124C41.5403 44.124 45.656 40.0084 45.656 34.9315C45.656 29.8546 41.5403 25.739 36.4635 25.739C31.3866 25.739 27.271 29.8546 27.271 34.9315C27.271 40.0084 31.3866 44.124 36.4635 44.124ZM36.4635 41.0598C39.848 41.0598 42.5918 38.316 42.5918 34.9315C42.5918 31.5469 39.848 28.8032 36.4635 28.8032C33.0789 28.8032 30.3352 31.5469 30.3352 34.9315C30.3352 38.316 33.0789 41.0598 36.4635 41.0598Z" fill="white"/>
							<path d="M45.656 24.2069C44.8098 24.2069 44.1239 24.8929 44.1239 25.739C44.1239 26.5851 44.8098 27.2711 45.656 27.2711C46.5022 27.2711 47.1881 26.5851 47.1881 25.739C47.1881 24.8929 46.5022 24.2069 45.656 24.2069Z" fill="white"/>
							<path fill-rule="evenodd" clip-rule="evenodd" d="M20.6125 23.0977C19.6106 25.0641 19.6106 27.6382 19.6106 32.7865L19.6106 37.0763C19.6106 42.2245 19.6106 44.7987 20.6125 46.765C21.4938 48.4947 22.9001 49.901 24.6298 50.7823C26.5962 51.7843 29.1703 51.7843 34.3186 51.7843L38.6084 51.7843C43.7566 51.7843 46.3309 51.7843 48.2971 50.7823C50.0268 49.901 51.4331 48.4947 52.3144 46.765C53.3164 44.7987 53.3164 42.2245 53.3164 37.0763L53.3164 32.7865C53.3164 27.6382 53.3164 25.0641 52.3144 23.0977C51.4331 21.368 50.0268 19.9617 48.2971 19.0804C46.3308 18.0785 43.7566 18.0785 38.6084 18.0785L34.3186 18.0785C29.1703 18.0785 26.5962 18.0785 24.6298 19.0804C22.9001 19.9617 21.4938 21.368 20.6125 23.0977ZM38.6084 21.1426L34.3186 21.1426C31.6939 21.1427 29.9096 21.145 28.5305 21.2577C27.1871 21.3675 26.5001 21.5664 26.0209 21.8106C24.8678 22.3981 23.9303 23.3357 23.3427 24.4888C23.0985 24.968 22.8996 25.655 22.7898 26.9984C22.6771 28.3775 22.6748 30.1618 22.6748 32.7865L22.6748 37.0763C22.6748 39.701 22.6772 41.4852 22.7898 42.8643C22.8996 44.2078 23.0985 44.8948 23.3427 45.374C23.9303 46.5271 24.8678 47.4646 26.0209 48.0521C26.5001 48.2963 27.1871 48.4953 28.5305 48.605C29.9096 48.7176 31.6939 48.7201 34.3186 48.7201L38.6084 48.7201C41.2332 48.7201 43.0173 48.7176 44.3964 48.605C45.7399 48.4953 46.4269 48.2963 46.9061 48.0521C48.0592 47.4646 48.9967 46.5271 49.5842 45.374C49.8284 44.8948 50.0275 44.2078 50.1372 42.8643C50.2498 41.4852 50.2522 39.701 50.2522 37.0763L50.2522 32.7865C50.2522 30.1618 50.2498 28.3775 50.1371 26.9984C50.0275 25.655 49.8284 24.968 49.5842 24.4888C48.9967 23.3357 48.0592 22.3981 46.9061 21.8106C46.4269 21.5664 45.7399 21.3675 44.3964 21.2577C43.0173 21.145 41.2332 21.1426 38.6084 21.1426Z" fill="white"/>
						</svg>
					</a>
					<a href="#">
						<svg class="md:w-8 md:h-8 lg:w-12 lg:h-12 xl:w-14 xl:h-14 2xl:w-18 2xl:h-16" viewBox="0 0 73 70" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M72.6284 27.5322C72.6284 12.3266 60.3018 -1.07762e-06 45.0962 -2.40694e-06L0.927048 -6.26833e-06L0.927044 42.3307C0.927043 57.5363 13.2536 69.8629 28.4592 69.8629L72.6284 69.8629L72.6284 27.5322Z" fill="#A0CB9E"/>
							<path d="M37.4891 17.8008C39.3701 17.7721 41.2373 17.787 43.1034 17.7721C43.1655 20.1058 44.1123 22.2063 45.6187 23.7621L45.6164 23.7598C47.2377 25.2203 49.3474 26.1671 51.6731 26.328L51.7053 26.3303V32.117C49.5083 32.0618 47.4423 31.5551 45.5796 30.6841L45.6739 30.7232C44.773 30.29 44.0112 29.8453 43.2873 29.3489L43.347 29.3879C43.3332 33.5809 43.3608 37.7738 43.3183 41.9518C43.1999 44.081 42.4921 46.0229 41.3568 47.6442L41.3798 47.6086C39.4816 50.3273 36.4067 52.1118 32.9101 52.2175H32.894C32.7527 52.2244 32.5861 52.2278 32.4183 52.2278C30.4304 52.2278 28.5724 51.674 26.989 50.7122L27.035 50.7386C24.1531 49.0047 22.1652 46.0378 21.7975 42.5872L21.7929 42.5401C21.7642 41.8219 21.7504 41.1038 21.7792 40.4005C22.3422 34.9092 26.943 30.6611 32.5355 30.6611C33.164 30.6611 33.7799 30.7151 34.3786 30.8174L34.3143 30.8082C34.343 32.9328 34.2568 35.0586 34.2568 37.1832C33.7707 37.0074 33.21 36.9051 32.6251 36.9051C30.4787 36.9051 28.6528 38.2771 27.9772 40.1926L27.9668 40.227C27.814 40.7177 27.7255 41.2819 27.7255 41.8656C27.7255 42.1023 27.7405 42.3367 27.7681 42.5665L27.7658 42.5389C28.1472 44.8899 30.1627 46.6641 32.593 46.6641C32.6631 46.6641 32.732 46.6629 32.8009 46.6595H32.7906C34.4717 46.6089 35.931 45.7046 36.756 44.3682L36.7675 44.3476C37.0743 43.9201 37.2846 43.403 37.3547 42.8411L37.3558 42.8251C37.4995 40.2546 37.442 37.6991 37.4558 35.1287C37.4696 29.342 37.442 23.5691 37.4845 17.7974L37.4891 17.8008Z" fill="white"/>
						</svg>
					</a>
					<a href="#">
						<svg class="md:w-8 md:h-8 lg:w-12 lg:h-12 xl:w-14 xl:h-14 2xl:w-18 2xl:h-16" viewBox="0 0 72 70" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M0.541626 35.5443C0.541626 15.9137 16.7644 0 36.395 0C55.6871 0 71.6302 15.6393 71.6302 34.9314C71.6302 54.2235 55.9908 69.8629 36.6987 69.8629H0.541626V35.5443Z" fill="#053F31"/>
							<path fill-rule="evenodd" clip-rule="evenodd" d="M39.4344 53.3164V36.77H44.4578L45.2784 29.416H39.4344V25.8341C39.4344 23.9405 39.4827 22.062 42.1289 22.062H44.809V16.8041C44.809 16.7251 42.5068 16.5465 40.1778 16.5465C35.3137 16.5465 32.2681 19.5933 32.2681 25.1878V29.416H26.8934V36.77H32.2681V53.3164H39.4344Z" fill="white"/>
						</svg>
					</a>
				</div>
			</div>
			<div class="flex justify-center items-center my-8 w-auto h-auto mt-12 md:mt-4">
				<form action="/search" method="get" class="mr-4 flex items-center justify-between text-sm leading-1 sm:py-1 py-1 pl-4 pr-2 rounded-full border border-black bg-custom-green-light md:w-8/12 w-full">
					<div class="flex flex-col items-start border-r-0 sm:border-r py-2 md:w-4/12 w-full">
						<label for="location" class="px-4 text-xs hidden sm:block font-bold">Location</label>
						<input type="search" name="location" placeholder="Rechercher une destination" class="px-4 rounded flex-grow bg-transparent border-none focus:outline-none align-middle w-full">
					</div>
					<div class="bg-black w-[1px] h-8 sm:flex hidden"></div>
					<div class="flex-col items-start border-rhidden sm:flex hidden py-2 w-3/12">
						<label for="start_date" class="px-4 text-xs font-bold">Arrivée</label>
						<input type="text" placeholder="Quand ?" onfocus="(this.type='date')" name="start_date" class="px-4 rounded flex-grow bg-transparent border-none focus:outline-none">
					</div>
					<div class="bg-black w-[1px] h-8 sm:flex hidden"></div>
					<div class="flex-col items-start sm:flex hidden py-2 w-3/12">
						<label for="end_date" class="px-4 text-xs font-bold">Départ</label>
						<input type="text" placeholder="Quand ?" onfocus="(this.type='date')" name="end_date" class="px-4 rounded flex-grow bg-transparent border-none focus:outline-none ">
					</div>
					<div class="bg-black w-[1px] h-8 sm:flex hidden"></div>
					<div class="sm:flex hidden flex-col items-start border-r-0 sm:border-r py-2 w-2/12">
						<label for="location" class="px-4 text-xs hidden sm:block font-bold">Fêtards</label>
						<input type="search" name="location" placeholder="Nombre de fêtards" class="px-4 rounded flex-grow bg-transparent border-none focus:outline-none align-middle">
					</div>
					<div class="w-2/12 flex flex-col justify-end items-end">
						<button type="submit" class="bg-custom_green_dark text-custom-green font-bold h-12 w-12  rounded-full flex flex-col justify-center items-center">
							<svg width="17" height="16" viewbox="0 0 15 14" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M13.5416 13.0417L10.4166 9.91671M1.45831 6.16671C1.45831 3.29022 3.79016 0.958374 6.66665 0.958374C9.54313 0.958374 11.875 3.29022 11.875 6.16671C11.875 9.04319 9.54313 11.375 6.66665 11.375C3.79016 11.375 1.45831 9.04319 1.45831 6.16671Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</button>
					</div>
				</form>
			</div>
			<div id="categories" class="flex whitespace-nowrap overflow-x-auto items-stretch">
				{% for categorie in categories %}
					<div class="categorie bg-white p-4 flex flex-col items-center justify-center cursor-pointer w-16 h-16 md:w-20 md:h-20 m-2 transform hover:scale-110 duration-300 shadow-md rounded" data-categorie-id="{{ categorie.id }}">
						<img class="w-16 h-16 md:w-12 md:h-12 object-scale-down" src="{{ categorie.icon }}" alt="{{ categorie.libelle }}">
						<p class="text-xs">{{ categorie.libelle }}</p>
					</div>
				{% endfor %}
			</div>
			<div id="locations" class="grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
				{% for location in locations %}
					{% set isFavoris = false %}
					{% for favori in favoris %}
						{% if favori.getLocations.id == location.id %}
							{% set isFavoris = true %}
						{% endif %}
					{% endfor %}
					<a href="{{ path('app_location', {id: location.id}) }}" class="location overflow-hidden p-2 flex flex-col space-y-4 rounded-3xl" data-categorie-ids="{{ location.Categories|map(c => c.id)|join(',') }}">
						<div class="relative">
							<div class="swiper-container overflow-hidden">
								<div class="swiper-wrapper">
									{% for image in location.images %}
										<div class="swiper-slide">
											<img class="w-full h-[350px] 2xl:h-[500px] object-cover mb-6 rounded-3xl" src="{{ asset('uploads/' ~ image.Nom) }}" alt="{{ location.Nom }}">
											{% if isFavoris %}
												<svg xmlns="http://www.w3.org/2000/svg" fill="green" class="add-favoris absolute top-0 right-0 m-4 h-6 md:h-6 lg:h-8" viewbox="0 0 24 24" stroke="green" data-location-id="{{ location.id }}">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
												</svg>
											{% else %}
												<svg xmlns="http://www.w3.org/2000/svg" fill="rgba(0, 0, 0, 0.5)" class="add-favoris absolute top-0 right-0 m-4 h-6 md:h-6 lg:h-8" viewbox="0 0 24 24" stroke="white" data-location-id="{{ location.id }}">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
												</svg>
											{% endif %}
										</div>
									{% endfor %}
								</div>
								<div style="color:#053F31;" class="swiper-button-next absolute top-2/3 right-0 transform -translate-y-1/2"></div>
								<div style="color:#053F31;" class="swiper-button-prev absolute top-2/3 left-0 transform -translate-y-1/2"></div>
							</div>
							<div class="flex items-center mb-2 font-cotorisHeavy">
								<h2 class="text-sm py-0.5 px-3 rounded-full border border-black w-fit-content">{{ location.nom }}</h2>
								{% for categorie in location.getCategories() %}
									<p class="text-sm py-0.5 px-3 rounded-full border border-black w-fit-content ml-1">{{ categorie.getLibelle() }}</p>
								{% endfor %}
							</div>
							<div class="flex items-center mb-2 font-cotorisHeavy">
								<p class="text-sm py-0.5 px-3 rounded-full border border-black w-fit-content">{{ location.adresse }}</p>
								<p class="text-sm py-0.5 px-3 rounded-full border border-black w-fit-content ml-1">{{ location.prix }}
									$ par jour</p>
							</div>
						</div>
					</a>
				{% endfor %}
			</div>
		</div>
		<button id="openMapButton" class="fixed bottom-12 left-1/2 transform -translate-x-1/2 bg-custom_green_dark text-custom-green rounded-full font-bold py-2 px-4 flex items-center justify-center z-50">
			Afficher la carte <i class="fas fa-map ml-2"></i>
		</button>
		<div id="mapModal" class="hidden fixed inset-0 overflow-auto bg-black bg-opacity-40 z-10 py-52 xl:py-32">
			<div class="modal-content bg-white m-auto p-5 border border-gray-800 w-4/5 relative">
				<span id="closeMapModal" class="text-gray-400 absolute top-0 right-0 m-2 text-4xl font-bold cursor-pointer hover:text-black focus:text-black">
					&times;
				</span>
				<div id="mapid" class="mt-8 h-[600px] xl:h-[800px]"></div>
			</div>
		</div>
	</div>


	<script>
		window.onload = function () {
			let map = null;
		
			function initMap() {
				if (map) return;
				map = L.map('mapid').setView([46.603354, 1.888334], 3); // Coordonnées de la France
		
				// Tuiles sur la carte en utilisant les tuiles de OpenStreetMap
				L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
					maxZoom: 19,
				}).addTo(map);
		
				{% for location in locations %}
					// adresse de la location à partir de l'objet location
					var address = "{{ location.getAdresse() }}";
		
					// Envoie une requête GET à l'API de géocodage de OpenStreetMap avec l'adresse de la location
					$.get('https://nominatim.openstreetmap.org/search?format=json&q=' + address, function (data) {
						// Vérifie si l'API a renvoyé des données
						if (data.length > 0) {
							// Marqueur sur la carte aux coordonnées de l'adresse
							L.marker([data[0].lat, data[0].lon]).addTo(map)
								// Infobulle au marqueur avec l'adresse de la location
								.bindPopup("<b>{{ location.getAdresse() }}</b>").openPopup();
						}
					});
				{% endfor %}
			}

			document.getElementById('openMapButton').addEventListener('click', function() {
				document.getElementById('mapModal').style.display = "block";
				setTimeout(initMap, 200);
			});
	
			document.getElementById('closeMapModal').addEventListener('click', function() {
				document.getElementById('mapModal').style.display = "none";
			});
		}
	</script>
{% endblock %}
